<html>
<head>
	<link rel="stylesheet" href="style/leaflet.css" />
	<style>
		#map { display: inline-block; width: 800px; height: 600px; vertical-align: top; }
		#feed-list { display: inline-block; width: 300px; height: 600px; vertical-align: top; background: #ddd; }
		.inpfeed { margin: 15px 0;}
		small { color: #333; }
	</style>
	<script type="text/javascript" src="js/lib/jquery.js"></script>
	<script type="text/javascript" src="js/lib/underscore.js"></script>
	<script type="text/javascript" src="js/lib/backbone.js"></script>
	<script type="text/javascript" src="../../../rdfquery/jquery.uri.js"></script>
	<script type="text/javascript" src="../../../rdfquery/jquery.xmlns.js"></script>
	<script type="text/javascript" src="../../../rdfquery/jquery.curie.js"></script>
	<script type="text/javascript" src="../../../rdfquery/jquery.datatype.js"></script>
	<script type="text/javascript" src="../../../rdfquery/jquery.rdf.js"></script>
	<script type="text/javascript" src="../../../rdfquery/jquery.rdfa.js"></script>
	<script type="text/javascript" src="../../../rdfquery/jquery.rdf.xml.js"></script>
	<script type="text/javascript" src="../../../rdfquery/jquery.rdf.turtle.js"></script>
	<script type="text/javascript" src="../../../rdfquery/jquery.rdf.json.js"></script>
	<script src="../../../require.js"></script>
	<script type="text/javascript">
		require.config({
   		baseUrl: "../../../../../datahappi/",
   		waitSeconds: 15
	});
	</script>
	<script src="js/lib/leaflet.js"></script>
	<script src="js/lib/jath.js"></script><!-- Used for XML parsing -->
	<script src="js/lib/jscoord.js"></script><!-- Used to convert eastings/northings to lat/lng -->
	<script src="js/lib/feedmap.js"></script>
	<script>
		// Our list of feeds
		var feeds = {
			"Transport from London": ["cameras", "chargePoints", "cycleHire", "disruptions", "stations (broken)", "roadsideMessages", "busRoutes"],
			"Southampton University Open Data": ["sotonPlaces"],
			"Brent Council": ["brentParks"]
		};
		// Set a couple of URLs we will need
		feedMap.tflRoot = "http://www.tfl.gov.uk/tfl/businessandpartners/syndication/feed.aspx?email=peter.g.west@gmail.com&feedId=";
		feedMap.iconRoot = "img/";

		$(document).ready(function () {
			// Hook up the input so that feeds can be dynamically loaded by the user
			$(".formload").submit(function (e) {
				e.preventDefault();
				feedMap.load($(".inpfeed").val()).done(function () {
					$(".inpfeed").val("");
				});
				return false;
			});

			// Show list of available feeds
			$(".feed-list").html(_(feeds).reduce(function (memo, fs, name) {
				return memo +
					"<b>Feeds available from <i>" + name + "</i>:</b><br>" +
					_(fs).reduce(function (memo, f) {
						return memo + '<a href="javascript:;" onclick="$(\'.inpfeed\').val(\'' + f + '\');">' + f + "</a>, ";
					}, "") +
					"<br><br>";
			}, ""));
		});
	</script>
</head>
<body>
	<h1>FeedMap - Dynamic feed plotter</h1>
	<div id="map"></div>
	<div id="feed-list">
		<h2>Feeds</h2>
		<div id="feeds"></div>
		<form class="formload"><input type="text" class="inpfeed" placeholder="Enter a feed here"><input type="submit" value="Load"></form><br>
		<small class="feed-list"></small>
	</div>
	<div><small>FeedMap by Peter West. Uses <a href="http://mapicons.nicolasmollet.com/">Map icons</a>.</small></div>
</body>
</html>
